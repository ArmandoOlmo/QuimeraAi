<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Chatbot - Chrome</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-box {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        button {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #4338ca;
        }
        .log {
            background: #000;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }
        .success { color: #22c55e; }
        .error { color: #ef4444; }
        .info { color: #3b82f6; }
        .warning { color: #f59e0b; }
    </style>
</head>
<body>
    <h1>üß™ Test del Chatbot - Chrome Debug</h1>
    
    <div class="test-box">
        <h2>1. Limpiar Cach√© de Chrome</h2>
        <p>Presiona <code>Cmd + Shift + Delete</code> (Mac) o <code>Ctrl + Shift + Delete</code> (Windows)</p>
        <p>Selecciona "Im√°genes y archivos en cach√©" y limpia</p>
        <button onclick="location.reload(true)">üîÑ Recargar (Hard Refresh)</button>
    </div>

    <div class="test-box">
        <h2>2. Test de Conectividad</h2>
        <button onclick="testDirect()">Test API Directa</button>
        <button onclick="testProxy()">Test Cloud Functions Proxy</button>
        <button onclick="checkMode()">Ver Modo Actual</button>
    </div>

    <div class="test-box">
        <h2>3. Test del Chatbot</h2>
        <button onclick="testChatbot()">Probar Chatbot</button>
        <button onclick="window.open('https://quimera.ai', '_blank')">Abrir quimera.ai</button>
    </div>

    <div class="log" id="log">
        <div class="info">üìã Log de pruebas:</div>
    </div>

    <script type="module">
        window.log = function(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: 'info',
                success: 'success',
                error: 'error',
                warning: 'warning'
            };
            logDiv.innerHTML += `<div class="${colors[type]}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        };

        window.checkMode = function() {
            const isProduction = !window.location.hostname.includes('localhost') && 
                                 !window.location.hostname.includes('127.0.0.1');
            
            log(`üåê Hostname: ${window.location.hostname}`, 'info');
            log(`üîç Is Production: ${isProduction}`, isProduction ? 'warning' : 'info');
            log(`üìç Should use proxy: ${isProduction}`, 'info');
        };

        window.testProxy = async function() {
            log('üîÑ Testing Cloud Functions proxy...', 'info');
            
            try {
                const response = await fetch('https://us-central1-quimeraai.cloudfunctions.net/gemini-generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        projectId: 'test-chrome-debug',
                        prompt: 'Responde solo con: OK',
                        model: 'gemini-1.5-flash'
                    })
                });

                log(`üì° Response status: ${response.status}`, response.ok ? 'success' : 'error');
                
                const contentType = response.headers.get('content-type');
                log(`üìù Content-Type: ${contentType}`, 'info');

                const text = await response.text();
                log(`üìÑ Response (first 200 chars): ${text.substring(0, 200)}`, 'info');

                if (contentType?.includes('application/json')) {
                    const data = JSON.parse(text);
                    log(`‚úÖ Proxy funciona correctamente`, 'success');
                    log(`üí¨ Response: ${JSON.stringify(data, null, 2)}`, 'success');
                } else {
                    log(`‚ùå ERROR: Response no es JSON, es HTML`, 'error');
                    log(`üîç Esto causa el error "Unexpected token '<'"`, 'error');
                }
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
                log(`Stack: ${error.stack}`, 'error');
            }
        };

        window.testDirect = async function() {
            log('üîë Testing direct API (requires API key)...', 'info');
            log('‚ö†Ô∏è  Esta prueba fallar√° en producci√≥n (por dise√±o)', 'warning');
            
            try {
                // This will fail in production (no API key exposed)
                log('‚ùå Direct API no disponible en producci√≥n (correcto)', 'warning');
            } catch (error) {
                log(`Error: ${error.message}`, 'error');
            }
        };

        window.testChatbot = async function() {
            log('ü§ñ Testing chatbot integration...', 'info');
            
            // Import and test the actual function
            try {
                log('üì¶ Cargando m√≥dulos...', 'info');
                
                // Test if we can access the proxy
                await testProxy();
                
                log('‚úÖ Si el proxy funciona, el chatbot deber√≠a funcionar', 'success');
                log('üí° Abre quimera.ai y prueba el chatbot', 'info');
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
            }
        };

        // Auto-check on load
        log('üöÄ P√°gina cargada', 'success');
        checkMode();
    </script>
</body>
</html>



