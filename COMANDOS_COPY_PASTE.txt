# ========================================
# COMANDOS LISTOS PARA COPIAR Y PEGAR
# ========================================
# Ejecuta estos comandos EN ORDEN en una terminal externa

# -----------------------------------------
# PASO 1: Instalar Firebase CLI
# -----------------------------------------
npm install -g firebase-tools

# Verificar instalación
firebase --version

# -----------------------------------------
# PASO 2: Login a Firebase
# -----------------------------------------
firebase login

# -----------------------------------------
# PASO 3: Ir al proyecto
# -----------------------------------------
cd /Users/armandoolmo/QuimeraAppCursor/QuimeraAi

# -----------------------------------------
# PASO 4: Configurar API Key de Gemini
# -----------------------------------------
# IMPORTANTE: Primero obtén tu API key de:
# https://aistudio.google.com/app/apikey
#
# Luego ejecuta (reemplaza TU_KEY con tu key real):

firebase functions:config:set gemini.api_key="TU_GEMINI_API_KEY_AQUI"

# Verificar que se configuró
firebase functions:config:get

# -----------------------------------------
# PASO 5: Deploy Cloud Functions
# -----------------------------------------
# Opción A: Script automatizado (recomendado)
./deploy-cloud-functions.sh

# Opción B: Manual
cd functions
npm install
npm run build
cd ..
firebase deploy --only functions:gemini-generate,functions:gemini-stream,functions:gemini-usage

# -----------------------------------------
# PASO 6: Verificar deployment
# -----------------------------------------
firebase functions:list

# -----------------------------------------
# PASO 7: Test rápido
# -----------------------------------------
curl -X POST https://us-central1-quimeraai.cloudfunctions.net/gemini-generate \
  -H "Content-Type: application/json" \
  -d '{"projectId":"test","prompt":"Hola","model":"gemini-1.5-flash"}'

# -----------------------------------------
# PASO 8: Actualizar .env.local
# -----------------------------------------
# Crea/edita el archivo .env.local en la raíz:
nano .env.local

# Agrega estas líneas:
# VITE_GEMINI_PROXY_URL=https://us-central1-quimeraai.cloudfunctions.net/gemini
# VITE_USE_GEMINI_PROXY=false
# VITE_GEMINI_API_KEY=TU_API_KEY_AQUI

# Guarda con: Ctrl+O, Enter, Ctrl+X

# -----------------------------------------
# PASO 9: Rebuild y Redeploy app
# -----------------------------------------
npm run build
./deploy-fix.sh

# -----------------------------------------
# PASO 10: Configurar restricciones
# -----------------------------------------
./configure-api-restrictions.sh

# O abre manualmente:
open "https://console.cloud.google.com/apis/credentials?project=quimeraai"
open "https://aistudio.google.com/app/apikey"

# ========================================
# COMANDOS DE MONITOREO
# ========================================

# Ver logs en tiempo real
firebase functions:log --follow

# Ver logs de una función específica
firebase functions:log --only gemini-generate

# Ver configuración actual
firebase functions:config:get

# Ver funciones deployadas
firebase functions:list

# Ver estadísticas en Google Cloud
open "https://console.cloud.google.com/functions?project=quimeraai"

# ========================================
# COMANDOS DE TROUBLESHOOTING
# ========================================

# Si algo falla, redeploy:
firebase deploy --only functions

# Ver últimos 50 logs:
firebase functions:log --limit 50

# Ver logs de error:
firebase functions:log | grep ERROR

# Actualizar API key:
firebase functions:config:set gemini.api_key="NUEVA_KEY"
firebase deploy --only functions



